var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Pandyle;(function(t){function e(e){return t._methods[e]}function n(t,e){var n=new RegExp("^\\w+"+e+"$");return n.test(t)}function r(e,r){t.$.isFunction(r)?n(e,"Filter")?t._filters[e]=r:n(e,"Converter")?t._converters[e]=r:t._methods[e]=r:t._variables[e]=r}function a(e){for(var n in e)t._config[n]=e[n]}t._variables={},t._methods={},t._filters={},t._converters={},t._components={},t._config={},t.getMethod=e,t.hasSuffix=n,t.register=r,t.config=a})(Pandyle||(Pandyle={}));var Pandyle;(function(t){function e(e){return"undefined"!=typeof t._components[e]}function n(e){t._components[e.name]=e.html}function r(e){return t._components[e]}function a(a){function i(e,r){e=e.replace(/<\s*script\s*>((?:.|\r|\n)*?)<\/script\s*>/g,function(t,e){return new Function(e)(),""}),e=e.replace(/<\s*style\s*>((?:.|\r|\n)*?)<\/style\s*>/g,function(e,n){var r="<style>"+n+"</style>";return t.$("head").append(r),""}),n({name:r,html:e}),o.html(e);var a=o.children();a.each(function(e,n){t.$(n).data("context",o.data("context"))}),o.data("children",a)}var o=t.$(a);o.children().remove();var c=o.attr("p-com");if(c=t.$.trim(c),e(c)){o.html(r(c));var p=o.children();p.each(function(e,n){t.$(n).data("context",o.data("context"))}),o.data("children",p)}else{var s="";if(/^@.*/.test(c))s=c.replace(/^@/,"");else{var d=c.split("."),u=t._config.comPath?t._config.comPath.Default||"./components/{name}.html":"./components/{name}.html";d.length>1?(u=t._config.comPath[d[0]],s=u.replace(/{.*}/g,d[1])):s=u.replace(/{.*}/g,c)}t.$.ajax({url:s,async:!1,success:function(t){i(t,c)}})}}t.hasComponent=e,t.addComponent=n,t.getComponent=r,t.loadComponent=a})(Pandyle||(Pandyle={})),function(t,e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports&&"object"==typeof module?exports=module.exports=e(require("jquery")):e(t.jQuery)}(this,function(t){return Pandyle.$=t,t.fn.vm=function(t,e){void 0===e&&(e=!0);var n=this;if(n.data("vm"))return n.data("vm");var r=new Pandyle.VM(n,t,e);return n.data("vm",r),r},t.fn.inputs=function(){var t=this;if(t.data("inputs"))return t.data("inputs");var e=new Pandyle.Inputs(t);return t.data("inputs",e),e},Pandyle});var Pandyle;(function(t){var e=function(){function e(t){this._data={},this._root=t,this.initData(),this.bindChange()}return e.prototype.data=function(){return t.$.extend({},this._data)},e.prototype.set=function(t){for(var e in t){this.setData(e,t[e]);var n=this._root.find('[name="'+e+'"]');this.updateDom(n,t[e]),n.trigger("modelChange",t[e])}},e.prototype.initData=function(){var e=this;this._root.find("input,textarea,select").each(function(n,r){var a=t.$(r),i=a.prop("tagName"),o=a.prop("name"),c=a.val()||"";switch(e.initName(o),i){case"INPUT":e.initData_input(a,o,c);break;case"TEXTAREA":e.initData_normal(a,o,c);break;case"SELECT":e.initData_select(a,o,c)}})},e.prototype.initData_input=function(t,e,n){var r=t.prop("type");switch(r){case"radio":this.initData_radio(t,e,n);break;case"checkbox":this.initData_check(t,e,n);break;default:this.initData_normal(t,e,n)}},e.prototype.initData_radio=function(e,n,r){t.$.isEmptyObject(this.getDataByName(n))&&this.setData(n,""),e.prop("checked")&&this.setData(n,r)},e.prototype.initData_check=function(e,n,r){t.$.isEmptyObject(this.getDataByName(n))&&this.setData(n,[]),e.prop("checked")&&this.getDataByName(n).push(r)},e.prototype.initData_normal=function(t,e,n){this.setData(e,n)},e.prototype.initData_select=function(t,e,n){this.setData(e,n)},e.prototype.bindChange=function(){var e=this;this._root.on("change viewChange","input,textarea,select",function(n){var r=t.$(n.currentTarget),a=r.prop("tagName"),i=r.prop("name"),o=r.val();switch(a){case"INPUT":e.onChange_input(r,i,o);break;case"TEXTAREA":e.onChange_normal(r,i,o);break;case"SELECT":e.onChange_select(r,i,o)}e.callBack&&e.callBack(i,e.getDataByName(i))})},e.prototype.onChange_normal=function(t,e,n){this.setData(e,n)},e.prototype.onChange_input=function(t,e,n){switch(t.prop("type")){case"radio":this.onChange_radio(t,e,n);break;case"checkbox":this.onChange_check(t,e,n);break;default:this.onChange_normal(t,e,n)}},e.prototype.onChange_radio=function(t,e,n){t.prop("checked")&&this.setData(e,n)},e.prototype.onChange_check=function(t,e,n){if(t.prop("checked"))this.getDataByName(e).push(n);else{var r=this.getDataByName(e).indexOf(n);this.getDataByName(e).splice(r,1)}},e.prototype.onChange_select=function(t,e,n){this.setData(e,n)},e.prototype.initName=function(t){t.split(".").reduce(function(t,e){return t[e]?t[e]:(t[e]={},t[e])},this._data)},e.prototype.getDataByName=function(t){return t.split(".").reduce(function(t,e){return t[e]},this._data)},e.prototype.setData=function(t,e){var n=t.split("."),r=n.pop(),a=n.reduce(function(t,e){return t[e]},this._data);a[r]=e},e.prototype.updateDom=function(t,e){var n=t.prop("tagName");switch(n){case"INPUT":this.updateDom_input(t,e);break;case"TEXTAREA":this.updateDom_normal(t,e);break;case"SELECT":this.updateDom_select(t,e);break;default:this.updateDom_normal(t,e)}},e.prototype.updateDom_input=function(t,e){var n=t.prop("type");switch(n){case"radio":this.updateDom_radio(t,e);break;case"checkbox":this.updateDom_check(t,e);break;default:this.updateDom_normal(t,e)}},e.prototype.updateDom_radio=function(e,n){e.each(function(e,r){var a=t.$(r);a.val()==n?a.prop("checked","checked"):a.prop("checked",!1)})},e.prototype.updateDom_check=function(e,n){e.each(function(e,r){var a=t.$(r);n.indexOf(a.val())>-1?a.prop("checked","checked"):a.prop("checked",!1)})},e.prototype.updateDom_normal=function(t,e){t.val(e)},e.prototype.updateDom_select=function(t,e){t.val(e)},e}();t.Inputs=e})(Pandyle||(Pandyle={}));var Pandyle;(function(t){var e=function(){function t(t){this._util=t,this._relations=[]}return t.CreateRelationCollection=function(e){return new t(e)},t.prototype.setRelation=function(t,e,n){var r=this;/^@.*/.test(t)?t=t.replace(/@(\w+)?/,function(t,n){return r._util.getAliasProperty(e,n)}):""!=n&&(t=n+"."+t),/^\./.test(t)&&(t=t.substr(1));var a=this._relations.filter(function(e){return e.property===t});0==a.length?this._relations.push({property:t,elements:[e]}):a[0].elements.indexOf(e)<0&&a[0].elements.push(e)},t.prototype.findSelfOrChild=function(t){var e=this;return this._relations.filter(function(n){return e._util.isSelfOrChild(t,n.property)})},t.prototype.removeChildren=function(t){for(var e=this._relations.length-1;e>=0;e--)this._util.isChild(t,this._relations[e].property)&&this._relations.splice(e,1)},t}();t.RelationCollection=e})(Pandyle||(Pandyle={}));var Pandyle;(function(t){var e=function(){function e(e,n,r){void 0===r&&(r=!0),this._data=t.$.extend({},n),this._root=e,this._methods={},this._variables={},this._defaultAlias={root:{data:this._data,property:""},window:{data:window,property:"@window"}},this._util=t.Util.CreateUtil(this),this._relationCollection=t.RelationCollection.CreateRelationCollection(this._util),this._renderer=new t.Renderer(this),r&&this.run()}return e.prototype.set=function(e,n){var r={};2===arguments.length?r[e]=n:r=e;for(var a in r){var i=a.split(/[\[\]\.]/).filter(function(t){return""!=t}),o=i.pop(),c=this._data;i.length>0&&(c=i.reduce(function(t,e){return t[e]},this._data)),c[o]=r[a],t.$.isArray(c[o])&&this._relationCollection.removeChildren(a);var p=this._relationCollection.findSelfOrChild(a);if(p.length>0)for(var s=0;s<p.length;s++)for(var d=p[s],u=0;u<d.elements.length;u++){var l=d.elements[u];l.data("alias")?this.render(l):d.elements.splice(u,1)}}},e.prototype.get=function(e){var n=this;if(!e)return t.$.extend({},this._data);switch(t.$.type(e)){case"array":return e.map(function(t){return n.get(t)});case"string":return this._util.getValue(this._root,e,this._data);case"object":var r={};for(var a in e)r[a]=this._util.getValue(this._root,e[a],this._data);return r;default:return null}},e.prototype.run=function(){this.render(this._root,this._data,"",this._defaultAlias)},e.prototype.render=function(e,n,r,a){var i=this;e.each(function(e,o){i._renderer.renderSingle(o,n,r,t.$.extend({},a))})},e.prototype.getMethod=function(t){return this._methods[t]},e.prototype.transfer=function(t,e){return this._methods[t](e)},e.prototype.register=function(e,n){t.$.isFunction(n)?this._methods[e]=n:this._variables[e]=n},e}();t.VM=e})(Pandyle||(Pandyle={}));var Pandyle;(function(t){var e=function(){function e(t){this._vm=t}return e.CreateUtil=function(t){var n=new e(t);return n},e.prototype.getValue=function(e,n,r){var a=this.calcu(n,e,r),i=t.$.type(a);return"string"===i||"number"===i||"boolean"===i||"null"===i||"undefined"===i?a:t.$.extend(this.toDefault(i),a)},e.prototype.calcu=function(e,n,r){var a=this,i=this.dividePipe(e);e=i.property;var o=i.method,c=e.match(/[@\w]+((?:\(.*?\))*|(?:\[.*?\])*)/g);if(!c)return"";var p=c.reduce(function(e,i){var o,c=/^([@\w]+)([\(|\[].*)*/.exec(i),p=c[1];o=/^@.*/.test(p)?a.getAliasData(n,p.substr(1)):e[p];var s=c[2];if(s){var d=s.match(/\[\d+\]|\(.*\)/g);return d.reduce(function(e,i){if(/\[\d+\]/.test(i)){var o=parseInt(i.replace(/\[(\d+)\]/,"$1"));return e[o]}if(/\(.*\)/.test(i)){var c=i.replace(/\((.*)\)/,"$1").replace(/\s/,"").split(","),s=c.map(function(t){return/^[A-Za-z_\$\@].*$/.test(t)?a.calcu(t,n,r):(""===t&&(t='""'),new Function("return "+t)())}),d=e||a._vm.getMethod(p)||t.getMethod(p)||window[p];return d.apply(a,s)}},o)}return o},r);return o?this.transfer(o,p):p},e.prototype.convertFromPattern=function(t,e,n,r,a){var i=this,o=/{{\s*([\w\.\[\]\(\)\,\$@\{\}\d\+\-\*\/\|\s]*?)\s*}}/g,c=!1;o.test(n)&&(t.data("binding")[e]||(t.data("binding")[e]={pattern:n,related:!1}),c=t.data("binding")[e].related);var p=n.replace(o,function(n,o){var p=i.dividePipe(o).property;return c||(i._vm._relationCollection.setRelation(p,t,a),t.data("binding")[e].related=!0),i.getValue(t,o,r)});return p},e.prototype.toDefault=function(t){switch(t){case"string":return"";case"number":return 0;case"boolean":return!1;case"array":return[];case"object":return{};case"function":return function(){};default:return null}},e.prototype.setAlias=function(t,e,n){var r=n||t.data("context");if(t.data("alias").self={data:r,property:e},t.attr("p-as")){var a=t.attr("p-as");t.data("alias")[a]={data:r,property:e}}},e.prototype.getAliasData=function(t,e){var n=t.data("alias");return n[e].data},e.prototype.getAliasProperty=function(t,e){var n=t.data("alias");return n[e].property},e.prototype.dividePipe=function(t){var e=t.split("|"),n=e[0].replace(/\s/g,""),r=e[1]?e[1].replace(/\s/g,""):null;return{property:n,method:r}},e.prototype.convert=function(t,e){if(/^{.*}$/.test(t)){var n=t.replace(/{|}/g,"").split(",");return n.reduce(function(t,n){var r=n.split(":");return/^[a-zA-z$_]+/.test(r[1])?t[r[0]]=r[1].split(".").reduce(function(t,e){return t[e]},e):t[r[0]]=new Function("return "+r[1])(),t},{})}return this._vm._methods[t](e)},e.prototype.isSelfOrChild=function(t,e){t=t.replace(/[\[\]\(\)\.]/g,function(t){return"\\"+t});var n=new RegExp("^"+t+"$|^"+t+"[\\[\\.]\\w+");return n.test(e)},e.prototype.isChild=function(t,e){var n=new RegExp("^"+t+"[\\[\\.]\\w+");return n.test(e)},e.prototype.transfer=function(t,e){return this._vm.transfer(t,e)},e.prototype.setRelation=function(t,e,n){this._vm._relationCollection.setRelation(t,e,n)},e}();t.Util=e})(Pandyle||(Pandyle={}));var Pandyle;(function(t){var e=function(){function t(){}return t.prototype.next=function(){this._next&&(this._next.init(this._context,this._util),this._next.execute())},t.prototype.deep=function(){},t.prototype.append=function(t){this._next=t},t.prototype.init=function(t,e){this._context=t,this._util=e},t}();t.DirectiveBase=e})(Pandyle||(Pandyle={}));var Pandyle;(function(t){var e=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.prototype.execute=function(){var e=t.$(this._context.element);if(e.attr("p-bind")){var n=t.$(e).attr("p-bind").split("^");n.forEach(function(t,n){var r=t.match(/^\s*([\w-]+)\s*:\s*(.*)$/),a=r[1],i=r[2].replace(/\s*$/,"");e.data("binding")[a]={pattern:i,related:!1}}),e.removeAttr("p-bind")}var r=e.data("binding"),a=e.data("context");for(var i in r)["text","If","Each","For","Context"].indexOf(i)<0&&t.$(e).attr(i,this._util.convertFromPattern(t.$(e),i,r[i].pattern,a,this._context.parentProperty));this.next()},n}(t.DirectiveBase);t.PBindDirective=e})(Pandyle||(Pandyle={}));var Pandyle;(function(t){var e=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.prototype.execute=function(){var e=t.$(this._context.element);e.attr("p-com")&&t.loadComponent(this._context.element),this.next()},n}(t.DirectiveBase);t.pComDirective=e})(Pandyle||(Pandyle={}));var Pandyle;(function(t){var e=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.prototype.execute=function(){var e=t.$(this._context.element);if(0===e.children().length){var n=e.data("context"),r=e.text();e.data("binding").text&&(r=e.data("binding").text.pattern);var a=this._util.convertFromPattern(e,"text",r,n,this._context.parentProperty);e.html(a)}},n}(t.DirectiveBase);t.pTextDirective=e})(Pandyle||(Pandyle={}));var Pandyle;(function(t){var e=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.prototype.execute=function(){var e=t.$(this._context.element),n=this._context.parentProperty;if(e.attr("p-if")&&(e.data("binding").If={pattern:e.attr("p-if"),related:!1},e.removeAttr("p-if")),e.data("binding").If){var r=e.parent();e.data("parent")||e.data("parent",r);var a=e.data("binding").If.pattern,i=e.data("context"),o=this._util.convertFromPattern(e,"If",a,i,n),c=new Function("return "+o);if(c()){if(0===e.parent().length){var p=e.data("pindex"),s=e.data("parent").children().filter(function(e,n){return t.$(n).data("pindex")==p-1});s.length>0?e.insertAfter(s):e.data("parent").prepend(e)}this.next()}else e.detach()}else this.next()},n}(t.DirectiveBase);t.PIfDirective=e})(Pandyle||(Pandyle={}));var Pandyle;(function(t){var e=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.prototype.execute=function(){var e=t.$(this._context.element),n=e.data("context"),r=this._context.parentProperty;if(e.attr("p-each")&&(e.data("binding").Each={pattern:e.attr("p-each"),related:!1},e.removeAttr("p-each")),e.data("binding").Each){var a=e.data("binding").Each.pattern.replace(/\s/g,""),i=this._util.dividePipe(a).property,o=this._util.calcu(a,e,n);e.data("pattern")||(e.data("pattern",e.html()),this._util.setRelation(i,e,r));var c=i;""!==r&&(c=r+"."+i);var p=e.data("alias"),s=e.data("pattern"),d=t.$(s);e.children().remove(),e.data("children")&&e.data("children").remove(),o.forEach(function(n,r){var a=d.clone(!0,!0),i=t.$.extend({},p,{index:{data:r,property:"@index"}});a.data({context:n,parentProperty:c.concat("[",r.toString(),"]"),alias:i}),e.append(a)}),e.data("children",e.children())}this.next()},n}(t.DirectiveBase);t.PEachDirective=e})(Pandyle||(Pandyle={}));var Pandyle;(function(t){var e=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.prototype.execute=function(){var e=t.$(this._context.element),n=e.data("context"),r=this._context.parentProperty;if(e.attr("p-for")&&(e.data("binding").For={pattern:e.attr("p-for"),related:!1},e.removeAttr("p-for")),e.data("binding").For){var a=e.parent();e.data("parent")||e.data("parent",a);var i=e.data("binding").For.pattern.replace(/\s/g,""),o=this._util.dividePipe(i).property,c=this._util.calcu(i,e,n);e.data("pattern")||(e.data("pattern",e.prop("outerHTML")),this._util.setRelation(o,e,r));var p=o;""!==r&&(p=r+"."+o);var s=e.data("alias"),d=e.data("pattern"),u=t.$(d);e.children().remove(),e.data("children")&&e.data("children").remove();var l=t.$("<div />");c.forEach(function(e,n){var r=u.clone(!0,!0),a=t.$.extend({},s,{index:{data:n,property:"@index"}});r.data({context:e,parentProperty:p.concat("[",n.toString(),"]"),alias:a}),l.append(r)});var h=l.children();e.data("children",h),e.detach();var f=e.data("pindex"),y=e.data("parent").children().filter(function(e,n){return t.$(n).data("pindex")==f-1});y.length>0?h.insertAfter(y):e.data("parent").prepend(h)}this.next()},n}(t.DirectiveBase);t.PForDirective=e})(Pandyle||(Pandyle={}));var Pandyle;(function(t){var e=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.prototype.execute=function(){var e=t.$(this._context.element),n=this._context.parentProperty;if(e.attr("p-context")&&(e.data("binding").Context={pattern:e.attr("p-context"),related:!1},e.removeAttr("p-context")),e.data("binding").Context){var r=void 0,a=e.data("binding").Context.pattern,i=this._util.dividePipe(a),o=i.property,c=i.method,p=o;""!==n&&(p=n+"."+o),r=e.data("ocontext")?e.data("ocontext"):e.data("context");var s=this._util.calcu(o,e,r);c&&(s=this._util.convert(c,t.$.extend({},s))),e.data("ocontext")||(this._util.setAlias(e,p,s),this._util.setRelation(o,t.$(e),n),e.data("ocontext",r)),e.data({context:s,oparentProperty:p}),e.children().each(function(e,n){t.$(n).data({context:s})}),this._context.parentProperty=p}this.next()},n}(t.DirectiveBase);t.PContextDirective=e})(Pandyle||(Pandyle={}));var Pandyle;(function(t){var e=function(){function e(t){this._util=t}return e.prototype.add=function(t){return this._firstDirective?(this._lastDirective.append(t),this._lastDirective=t):this._firstDirective=this._lastDirective=t,this},e.prototype.start=function(t){this._firstDirective.init(t,this._util),this._firstDirective.execute()},e.createPipeLine=function(n){var r=new e(n);return r.add(new t.PContextDirective).add(new t.PIfDirective).add(new t.PForDirective).add(new t.PEachDirective).add(new t.PBindDirective).add(new t.pComDirective).add(new t.pTextDirective),r},e}();t.PipeLine=e})(Pandyle||(Pandyle={})),Array.prototype.filter||(Array.prototype.filter=function(t){var e=this.length;if("function"!=typeof t)throw new TypeError;for(var n=new Array,r=arguments[1],a=0;a<e;a++)if(a in this){var i=this[a];t.call(r,i,a,this)&&n.push(i)}return n}),Array.prototype.forEach||(Array.prototype.forEach=function(t){var e=this.length;if("function"!=typeof t)throw new TypeError;for(var n=arguments[1],r=0;r<e;r++)r in this&&t.call(n,this[r],r,this)}),Array.prototype.map||(Array.prototype.map=function(t){var e=this.length;if("function"!=typeof t)throw new TypeError;for(var n=new Array(e),r=arguments[1],a=0;a<e;a++)a in this&&(n[a]=t.call(r,this[a],a,this));return n}),Array.prototype.reduce||(Array.prototype.reduce=function(t,e){"use strict";if(null===this||"undefined"==typeof this)throw new TypeError("Array.prototype.reduce called on null or undefined");if("function"!=typeof t)throw new TypeError(t+" is not a function");var n,r,a=this.length>>>0,i=!1;for(1<arguments.length&&(r=e,i=!0),n=0;a>n;++n)this.hasOwnProperty(n)&&(i?r=t(r,this[n],n,this):(r=this[n],i=!0));if(!i)throw new TypeError("Reduce of empty array with no initial value");return r}),Array.prototype.indexOf||(Array.prototype.indexOf=function(t){for(var e=0,n=this.length;e<n;e++)if(this[e]===t)return e;return-1});var Pandyle;(function(t){var e=function(){function e(e){this._util=t.Util.CreateUtil(e),this._pipeline=t.PipeLine.createPipeLine(this._util)}return e.prototype.renderSingle=function(e,n,r,a){var i=t.$(e);i.data("context")||i.data("context",n),i.data("binding")||i.data("binding",{}),i.data("parentProperty")||i.data("parentProperty",r),!a||t.$.isEmptyObject(a)||i.data("alias")||i.data("alias",a),n=i.data("context"),r=i.data("parentProperty"),this._util.setAlias(i,r,n),this.renderPipe(e,r),n=i.data("context"),i.data("oparentProperty")&&(r=i.data("oparentProperty")),this.renderChild(e,n,r)},e.prototype.renderChild=function(e,n,r){var a=this,i=t.$(e);i.data("children")||i.data("children",i.children());var o=i.data("children");if(o.length>0){var c=i.data("alias");o.each(function(e,i){var o=t.$(i);o.data("context")||o.data("context",n),o.data("pindex",e),a.renderSingle(o[0],n,r,t.$.extend({},c))})}},e.prototype.renderPipe=function(t,e){var n={element:t,parentProperty:e};this._pipeline.start(n)},e}();t.Renderer=e})(Pandyle||(Pandyle={}));